<section class="content-header">
  <h2>ユーザー詳細</h2>
</section>

<section class="content">
  <div class="row">
    <div class="col-md-6">

      <div class="box box-default">
        <div class="box-header with-border">
          <h3 class="box-title">基本情報</h3>
        </div>
        <div class="box-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label class="col-md-4 control-label">ユーザー ID</label>
              <div class="col-md-8">
                <div class="form-control"><%= @media_user.id %></div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">ポイント</label>
              <div class="col-md-8">
                <div class="form-control"><%= @media_user.point %></div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">総獲得ポイント</label>
              <div class="col-md-8">
                <div class="form-control"><%= @media_user.total_point %></div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">ステータス</label>
              <div class="col-md-8">
                <div class="form-control-static">
                  <span class="label label-success">有効</span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">登録日時</label>
              <div class="col-md-8">
                <div class="form-control"><%= l @media_user.created_at, :format => :default %></div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">更新日時</label>
              <div class="col-md-8">
                <div class="form-control"><%= l @media_user.updated_at, :format => :default %></div>
              </div>
            </div>
          </form>
        </div>
      </div><!-- /.box -->

    </div><!-- /.col-md-6 -->

    <div class="col-md-6">
      <div class="box box-default">
        <div class="box-header with-border">
          <h3 class="box-title">端末情報</h3>
        </div>
        <div class="box-body">
          <form class="form-horizontal">
            <div class="form-group">
              <label class="col-md-4 control-label">端末 ID</label>
              <div class="col-md-8">
                <div class="form-control"><%= @media_user.terminal_id %></div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">端末情報</label>
              <div class="col-md-8">
                <textarea rows="5" readonly class="form-control"><%= @media_user.terminal_info %></textarea>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label">Android 登録 ID</label>
              <div class="col-md-8">
                <textarea rows="2" readonly class="form-control"><%= @media_user.android_registration_id %></textarea>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label"></label>
              <div class="col-md-8">
                <div class="input-group">
                  <input class="form-control" type="text">
                  <div class="input-group-btn">
                    <button type="button" class="btn btn-danger">通知</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div><!-- /.col-md-6 -->
  </div><!-- /.row -->

  <div class="row">
    <div class="col-md-12">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">ポイント履歴</h3>
        </div>
        <div class="box-body">
          <p>※別画面で全ての一覧を表示。フィルター、ページングの機能をつける。</p>

          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th class="col-sm-1">ID</th>
                <th class="col-sm-1 text-center">キャンペーン ID</th>
                <th class="col-sm-3">名称</th>
                <th class="col-sm-1 text-right">ポイント</th>
                <th class="col-sm-3"></th>
                <th class="col-sm-2">日時</th>
                <th class="col-sm-2"></th>
                <th class="col-sm-1"></th>
              </tr>
            </thead>

            <tbody>
              <% @point_histories.each do |point_history| %>
              <% point = point_history.source.kind_of?(Point) ? point_history.source : nil %>
              <% campaign = point_history.source.source.kind_of?(Campaign) ? point_history.source.source : nil %>
              <tr>
                <td><%= point_history.id %></td>
                <td class="text-center">
                  <% if not campaign.nil? %>
                    <%= link_to campaign.id, edit_campaign_path(campaign), class: 'btn btn-default btn-xs' %>
                  <% end %>
                </td>
                <td>
                  <% if not campaign.nil? %>
                    <%= campaign.name %>
                  <% end %>
                </td>
                <td class="text-right">
                  <% if point_history.point_change > 0 %>
                    +
                  <% else %>
                    -
                  <% end %>
                  <%= number_with_delimiter(point_history.point_change) %>
                </td>
                <td></td>
                <td>
                  <%= l point.created_at, :format => :default %>
                </td>
                <td class="text-center">
                </td>
                <td class="text-center">
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>

        </div>
      </div>
    </div><!-- /.col-md-12 -->
  </div><!-- /.row -->

  <div class="row">
    <div class="col-md-12">
      <div class="box box-info">
        <div class="box-header with-border">
          <h3 class="box-title">クリック履歴</h3>
        </div>
        <div class="box-body">
          <p>※別画面で全ての一覧を表示。フィルター、ページングの機能をつける。</p>

          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th class="col-sm-1">ID</th>
                <th class="col-sm-1 text-center">オファー ID<br>キャンペーン ID</th>
                <th class="col-sm-3">名称</th>
                <th class="col-sm-1">IP</th>
                <th class="col-sm-3">クリック情報</th>
                <th class="col-sm-2">日時</th>
                <th class="col-sm-2">
                  <small class="text-muted">※括弧内の数字は成果件数。通常は 1。</small>
                </th>
                <th class="col-sm-1"></th>
              </tr>
            </thead>

            <tbody>
              <% @click_histories.each do |click_history| %>
              <tr>
                <td><%= click_history.id %></td>
                <td class="text-center">
                  <%= click_history.offer_id %><br>
                  <% if not click_history.offer.nil? %>
                    <%= link_to click_history.offer.campaign_id, edit_campaign_path(click_history.offer.campaign), class: 'btn btn-default btn-xs' %>
                  <% end %>
                </td>
                <td>
                  <% if not click_history.offer.nil? %>
                    <%= click_history.offer.name %>
                  <% end %>
                </td>
                <td><%= click_history.ip_address %></td>
                <td><%= truncate(click_history.user_agent, :length => 35) %></td>
                <td>
                  <%= l click_history.created_at, :format => :default %>
                </td>
                <td class="text-center">
                  <% if not click_history.offer.nil? %>
                    <% points_size = @media_user.count_points_by_campaign(click_history.offer.campaign) %>
                  <% else %>
                    <% points_size = 0 %>
                  <% end %>
                  <% if points_size > 0 %>
                  <span class="label label-success">達成 (<%= points_size %>)</span>
                  <% else %>
                  <span class="label label-default">未達成</span>
                  <% end %>
                </td>
                <td class="text-center">
                  <div class="btn-group">
                    <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right">
                      <% if not click_history.offer.nil? %>
                      <li><%= link_to '手動成果',
                              add_point_by_offer_media_user_path(@media_user, { :offer_id => click_history.offer.id }),
                              data: { confirm: 'Are you sure?' } %></li>
                      <% end %>
                    </ul>
                  </div>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div><!-- /.col-md-12 -->
  </div><!-- /.row -->

  <div class="row">
    <div class="col-md-12">
      <div class="box box-primary">
        <div class="box-header with-border">
          <h3 class="box-title">ポイント資産一覧</h3>
        </div>
        <div class="box-body">
          <p>※あとで非表示に。</p>

          <table class="table table-striped table-bordered table-hover">
            <thead>
              <tr>
                <th class="col-sm-1">ID</th>
                <th class="col-sm-1 text-center">キャンペーン ID</th>
                <th class="col-sm-3">名称</th>
                <th class="col-sm-1">ポイント</th>
                <th class="col-sm-1">未消化</th>
                <th class="col-sm-2">取得日時</th>
                <th class="col-sm-2">有効期限</th>
                <th class="col-sm-2"></th>
                <th class="col-sm-1"></th>
              </tr>
            </thead>

            <tbody>
              <% @points.each do |point| %>
              <% campaign = point.source.kind_of?(Campaign) ? point.source : nil %>
              <tr>
                <td><%= point.id %></td>
                <td class="text-center">
                  <% if not campaign.nil? %>
                    <%= link_to campaign.id, edit_campaign_path(campaign), class: 'btn btn-default btn-xs' %>
                  <% end %>
                </td>
                <td>
                  <% if not campaign.nil? %>
                    <%= campaign.name %>
                  <% end %>
                </td>
                <td class="text-right"><%= point.point %></td>
                <td class="text-right"><%= point.remains %></td>
                <td>
                  <%= l point.created_at, :format => :default %>
                </td>
                <td>
                  <% if not point.expiration_at.nil? %>
                    <%= l point.expiration_at, :format => :default %>
                  <% else %>
                    期限なし
                  <% end %>
                </td>
                <td class="text-center">
                  <span class="label label-default">手動</span>
                </td>
                <td class="text-center">
                  <div class="btn-group">
                    <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right">
                      <li><a href="#">取り消し</a></li>
                    </ul>
                  </div>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>

        </div>
      </div>
    </div><!-- /.col-md-12 -->
  </div><!-- /.row -->

</section>

